# C++ Image Filtering Project

Практическое задание 3

## Описание

Проект реализует фильтрацию шума на изображениях с использованием двух типов фильтров:
- **Фильтр скользящего среднего** (Moving Average) - усредняет значения пикселей по буферу
- **Медианный фильтр** (Median Filter) - заменяет значение пикселя медианой из окрестности

Проект также включает алгоритм оценки схожести изображений с использованием метрик:
- **MSE** (Mean Squared Error) - средняя квадратичная ошибка
- **PSNR** (Peak Signal-to-Noise Ratio) - пиковое отношение сигнал/шум
- **SSIM** (Structural Similarity Index) - индекс структурного сходства
- **Корреляция** (Pearson correlation coefficient) - коэффициент корреляции Пирсона

## Сборка

Проект собирается через **MSYS**:

```bash
make
```

## Тестирование

Для тестирования фильтров нужны **изображения с шумом**. Есть два способа получить тестовые изображения:

1. **Автоматическая генерация** (рекомендуется) - используйте встроенный генератор
2. **Свои изображения** - конвертируйте любые изображения в BMP и добавьте шум в графическом редакторе

### Подготовка тестовых данных

1. **Папки `images` и `output` уже созданы** в проекте.

2. **Создание тестовых изображений с шумом** (рекомендуется):

   В проекте есть утилита для генерации тестовых изображений с шумом:
   
   ```bash
   # Собрать генератор
   make generate_test_image
   
   # Сгенерировать тестовое изображение с градиентом и шумом
   ./generate_test_image.exe gradient 0.1 images/test_noisy.bmp
   
   # Или с синусоидальным паттерном
   ./generate_test_image.exe sine 0.15 images/test_sine.bmp
   ```
   
   Параметры:
   - Первый аргумент: `gradient` или `sine` (тип паттерна)
   - Второй аргумент: уровень шума (0.0-1.0, например 0.1 = 10%)
   - Третий аргумент: имя выходного файла
   
   Генератор создаст 3 файла:
   - `*_clean.bmp` - оригинальное изображение без шума
   - `*_noisy.bmp` - изображение с salt-and-pepper шумом
   - `*_gaussian.bmp` - изображение с гауссовым шумом

3. **Использование своих BMP файлов**:
   - Поместите любые BMP файлы (8-bit или 24-bit) в папку `images`
   - Программа автоматически обработает все найденные BMP файлы
   - Для лучшей демонстрации работы фильтров используйте изображения с шумом
   
   **Типы шума для тестирования:**
   - **Salt-and-pepper** (импульсный шум) - черные и белые точки - лучше всего фильтруется медианным фильтром
   - **Гауссов шум** - случайные отклонения яркости - хорошо фильтруется фильтром скользящего среднего
   - **Смешанный шум** - комбинация разных типов шума

### Запуск тестов

1. **Соберите проект** (если еще не собрали):
   ```bash
   make
   ```

2. **Запустите программу**:
   ```bash
   ./filter.exe
   ```

   Программа автоматически:
   - Найдет все BMP файлы в папке `images`
   - Применит фильтры с разными параметрами
   - Сохранит отфильтрованные изображения в папку `output`
   - Создаст файл `results.csv` с метриками схожести

3. **Проверьте результаты**:
   - Откройте папку `output` - там будут сохранены все отфильтрованные изображения
   - Откройте `results.csv` - там будут метрики для каждого фильтра

### Пример вывода программы:

```
=== Image Filtering and Similarity Analysis ===
Input folder: images
Output folder: output
CSV file: results.csv

Found 1 BMP file(s)

Processing: test.bmp
  Size: 640x480
  Moving Average (4): MSE=45.23, PSNR=31.58, SSIM=0.9234, Corr=0.9876
  Moving Average (8): MSE=38.12, PSNR=32.31, SSIM=0.9456, Corr=0.9923
  ...
  Median (3): MSE=52.34, PSNR=30.92, SSIM=0.9123, Corr=0.9845
  ...

Results saved to results.csv

=== Processing complete ===
Processed 1 image(s)
Generated 7 result(s)
```

## Использование

Программа автоматически обрабатывает все BMP файлы из папки `images` и сохраняет результаты в папку `output`.

### Аргументы командной строки:

```bash
./filter.exe [input_folder] [output_folder] [csv_file]
```

- `input_folder` - папка с исходными изображениями (по умолчанию: `images`)
- `output_folder` - папка для сохранения отфильтрованных изображений (по умолчанию: `output`)
- `csv_file` - имя CSV файла с результатами (по умолчанию: `results.csv`)

### Примеры использования:

```bash
# Использование папок по умолчанию
./filter.exe

# Указание своих папок
./filter.exe my_images my_output my_results.csv
```

## Структура проекта

- `image.h` / `image.cpp` - работа с BMP изображениями (загрузка, сохранение)
- `filters.h` / `filters.cpp` - реализация фильтров
- `similarity.h` / `similarity.cpp` - вычисление метрик схожести
- `main.cpp` - основная программа обработки

## Формат результатов

Результаты сохраняются в CSV файл со следующими колонками:
- `Image` - имя исходного файла
- `Filter` - тип фильтра (MovingAverage или Median)
- `FilterSize` - размер фильтра
- `MSE` - средняя квадратичная ошибка
- `PSNR` - пиковое отношение сигнал/шум (дБ)
- `SSIM` - индекс структурного сходства (0-1)
- `Correlation` - коэффициент корреляции (-1 до 1)

## Алгоритм оценки схожести

Алгоритм использует комбинацию метрик для максимально "человеческой" оценки схожести:

1. **MSE** - показывает общую разницу между изображениями (чем меньше, тем лучше)
2. **PSNR** - показывает качество восстановления (чем больше, тем лучше)
3. **SSIM** - учитывает структурное сходство, яркость и контраст (близко к человеческому восприятию)
4. **Корреляция** - показывает линейную зависимость между изображениями

SSIM является наиболее важной метрикой, так как она лучше всего соответствует человеческому восприятию качества изображения.

## Задание

[ПЗ 3 Фильтрация шума](https://docs.google.com/document/d/1KocK80F0pKn2P2UU60s-uS77d3GSLggxyWnw-s5jRi8/edit?tab=t.0)

